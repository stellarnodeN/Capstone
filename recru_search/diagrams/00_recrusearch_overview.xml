<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net">
  <diagram name="RecruSearch Protocol Overview">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" page="1" pageScale="1" pageWidth="1400" pageHeight="900">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>
        <!-- Title -->
        <mxCell id="title" value="RecruSearch Protocol Overview" style="text;fontSize=18;fontStyle=1;align=center;strokeColor=none;fillColor=none;" vertex="1" parent="1">
          <mxGeometry x="400" y="10" width="600" height="40" as="geometry"/>
        </mxCell>
        <!-- Actors -->
        <mxCell id="researcher" value="Researcher" style="ellipse;fillColor=#e3f2fd;strokeColor=#1976d2;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="120" width="130" height="55" as="geometry"/>
        </mxCell>
        <mxCell id="participant" value="Participant" style="ellipse;fillColor=#e8f5e8;strokeColor=#388e3c;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="280" width="130" height="55" as="geometry"/>
        </mxCell>
        <mxCell id="admin" value="Protocol Admin" style="ellipse;fillColor=#fffde7;strokeColor=#fbc02d;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="60" y="40" width="130" height="55" as="geometry"/>
        </mxCell>
        <!-- Programs -->
        <mxCell id="studyprog" value="study.rs&#xa;Study Account, create/publish/close&#xa;Eligibility fields, lifecycle, reward" style="rounded=1;fillColor=#fff9c4;strokeColor=#fbc02d;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="50" width="220" height="90" as="geometry"/>
        </mxCell>
        <mxCell id="rewardprog" value="reward.rs&#xa;RewardVault PDA, vault funding, SPL payouts, claim tracking" style="rounded=1;fillColor=#c8e6c9;strokeColor=#388e3c;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="170" width="220" height="80" as="geometry"/>
        </mxCell>
        <mxCell id="consentprog" value="consent.rs&#xa;Mint/revoke ConsentNFT&#xa;One per (participant,study)&#xa;CPI to Metaplex" style="rounded=1;fillColor=#ede7f6;strokeColor=#7b1fa2;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="280" width="220" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="submissionprog" value="submission.rs&#xa;Submit data (encrypted hash + IPFS CID)&#xa;SubmissionAccount PDA" style="rounded=1;fillColor=#e1f5fe;strokeColor=#0288d1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="370" width="220" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="datamgmtprog" value="data_management.rs&#xa;Survey schema, analytics, export, GDPR/anonymization" style="rounded=1;fillColor=#fffde7;strokeColor=#5e35b1;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="470" width="220" height="70" as="geometry"/>
        </mxCell>
        <mxCell id="adminprog" value="initialize_protocol.rs&#xa;AdminState PDA, protocol config/fee/pause" style="rounded=1;fillColor=#ffe082;strokeColor=#fbc02d;fontSize=12;" vertex="1" parent="1">
          <mxGeometry x="270" y="570" width="220" height="60" as="geometry"/>
        </mxCell>
        <!-- Data Flows -->
        <mxCell id="r_study" value="create_study/set_criteria" style="endArrow=block;strokeColor=#1976d2;" edge="1" parent="1" source="researcher" target="studyprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="r_reward" value="create_reward_vault" style="endArrow=block;strokeColor=#388e3c;" edge="1" parent="1" source="researcher" target="rewardprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="r_schema" value="create_survey_schema" style="endArrow=block;strokeColor=#5e35b1;" edge="1" parent="1" source="researcher" target="datamgmtprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="p_elig" value="mint_consent_nft" style="endArrow=block;strokeColor=#7b1fa2;" edge="1" parent="1" source="participant" target="consentprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="p_submit" value="submit_data" style="endArrow=block;strokeColor=#0288d1;" edge="1" parent="1" source="participant" target="submissionprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="p_claim" value="claim_reward" style="endArrow=block;strokeColor=#388e3c;" edge="1" parent="1" source="participant" target="rewardprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="admin_init" value="initialize_protocol" style="endArrow=block;strokeColor=#fbc02d;" edge="1" parent="1" source="admin" target="adminprog"><mxGeometry relative="1" as="geometry"/></mxCell>
        <!-- External Dependencies -->
        <mxCell id="ipfs" value="IPFS/Arweave&#xa;(encrypted data, schema docs)" style="shape=cloud;fillColor=#b2ebf2;strokeColor=#00acc1;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="470" width="180" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="metaplex" value="Metaplex Program&#xa;(NFT mint/burn CPI)" style="hexagon;fillColor=#ede7f6;strokeColor=#7b1fa2;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="320" width="130" height="50" as="geometry"/>
        </mxCell>
        <mxCell id="spltoken" value="SPL Token Program" style="hexagon;fillColor=#fffde7;strokeColor=#43a047;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="570" y="180" width="120" height="50" as="geometry"/>
        </mxCell>
        <!-- CPI, storage flow arrows -->
        <mxCell id="prog_spl" value="reward payout (CPI)" style="dashed=1;endArrow=block;strokeColor=#388e3c;" edge="1" parent="1" source="rewardprog" target="spltoken"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="prog_metaplex" value="mint/burn cNFT (CPI)" style="dashed=1;endArrow=block;strokeColor=#7b1fa2;" edge="1" parent="1" source="consentprog" target="metaplex"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="sub_ipfs" value="off-chain encrypted data" style="endArrow=block;strokeColor=#00acc1;" edge="1" parent="1" source="submissionprog" target="ipfs"><mxGeometry relative="1" as="geometry"/></mxCell>
        <mxCell id="schema_ipfs" value="off-chain schema content" style="endArrow=block;strokeColor=#00acc1;" edge="1" parent="1" source="datamgmtprog" target="ipfs"><mxGeometry relative="1" as="geometry"/></mxCell>
        <!-- Legend -->
        <mxCell id="legend" value="Legend
Ellipse: User
Yellow: study.rs
Green: reward.rs / rewards
Purple: consent.rs / NFT
Blue: submission.rs / data
Tan: data_management.rs
Yellow-tan: admin setup
Cloud: off-chain storage
Hex: 3rd-party program (CPI)
Solid arrow: user/program call
Dashed: CPI/cross-program
" style="swimlane;fillColor=#fffde7;strokeColor=#9e9e9e;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="850" y="90" width="290" height="290" as="geometry"/>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile> 